<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Avaliação – Declamação</title>

<style>
body{font-family:Arial;background:#9c8a8a;margin:0;padding:10px}
.container{max-width:1200px;margin:auto;background:#fff;border:2px solid #000}
.header{background:#ffe066;border-bottom:2px solid #000;padding:10px}

.linha{
  display:grid;
  grid-template-columns:1fr 1fr 1fr 1fr 1fr;
  gap:5px;
  padding:5px;
  background:#ffe066
}

.grid{
  display:grid;
  grid-template-columns:1fr 1fr 1fr 1fr;
  gap:5px;
  padding:5px
}

.box{
  border:2px solid #000;
  background:#ffe066;
  padding:5px;
  font-size:13px
}

.box h3{text-align:center;margin:0 0 5px}
textarea{width:100%;height:60px}
.notaFinal{font-size:22px;font-weight:bold;text-align:center}
select,input{width:100%}

/* linhas pontilhadas */
.linha-nota{
  display:flex;
  align-items:center;
  gap:6px;
  margin-bottom:6px
}
.linha-nota .texto{white-space:nowrap}
.linha-nota .pontilhado{flex:1;border-bottom:1px dotted #000}
.input-nota{width:42px;text-align:center}

.resumo-direita{
  display:flex;
  justify-content:space-between;
  font-weight:bold;
  margin-top:6px;
  border-top:1px solid #000;
  padding-top:4px
}

/* inferior */
.grid-inferior{
  display:grid;
  grid-template-columns:1.6fr 2.4fr 0.8fr;
  gap:6px;
  padding:6px
}

.grid-rodape{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:6px;
  padding:6px
}

button{
  padding:10px 30px;
  font-size:16px;
  font-weight:bold;
  background:#fc7a00;
  border:2px solid #000;
  border-radius:6px;
  cursor:pointer
}
button:hover{background:#1b5e20;color:#fff}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="loginBox" style="max-width:400px;margin:80px auto;padding:20px;border:2px solid #000;background:#ffe066">
  <h3 style="text-align:center">Acesso do Avaliador</h3>
  <input id="usuario" placeholder="Usuário" style="margin-bottom:10px">
  <input id="senha" type="password" placeholder="Senha" style="margin-bottom:10px">
  <button onclick="fazerLogin()" style="width:100%">Entrar</button>
  <div id="erroLogin" style="color:red;text-align:center;margin-top:8px"></div>
</div>

<!-- SISTEMA -->
<div id="sistema" style="display:none">
<div class="container">

<!-- CABEÇALHO -->
<div class="header" style="display:grid;grid-template-columns:100px 1fr 100px;align-items:center">
<img src="https://raw.githubusercontent.com/CCN1989/Imagens/refs/heads/main/Logo%20pequeno.png" height="70">
<div style="text-align:center">
<strong>MTG – MOVIMENTO TRADICIONALISTA GAÚCHO</strong><br>
2º Chamas da Poesia – CTG Chama Nativa – 12ª RT<br>
<strong>Planilha de Avaliação – Declamação</strong>
</div>
<img src="https://github.com/CCN1989/Imagens/blob/main/12RT.png?raw=true" height="70">
</div>

<!-- SELEÇÃO -->
<div style="padding:8px;background:#ffe066;border-bottom:2px solid #000">
<select id="codCandidato">
<option value="">Selecione CÓDIGO do candidato *</option>
</select>
</div>

<!-- DADOS -->
<div class="linha">
<div>Categoria:<br><b id="concorrente"></b></div>
<div>Concorrente:<br><b id="categoria"></b></div>
<div>Entidade:<br><b id="entidade"></b></div>
<div>Município:<br><b id="municipio"></b></div>
<div>RT:<br><b id="rt"></b></div>
</div>

<!-- QUADRANTES (mantidos) -->
<div class="grid">
<div class="box">
<h3>Fundamento da Voz (3,00)</h3>
<div class="linha-nota"><span class="texto">Imposição</span><span class="pontilhado"></span><input id="voz1" class="input-nota" oninput="calc()"></div>
<div class="linha-nota"><span class="texto">Dicção</span><span class="pontilhado"></span><input id="voz2" class="input-nota" oninput="calc()"></div>
<div class="linha-nota"><span class="texto">Inflexão</span><span class="pontilhado"></span><input id="voz3" class="input-nota" oninput="calc()"></div>
<div class="resumo-direita"><span>Nota:<b id="notaVoz">3,00</b></span></div>
</div>

<div class="box">
<h3>Interpretação (4,00)</h3>
<input id="notaInter" class="input-nota" oninput="calc()">
</div>
</div>

<!-- INFERIOR -->
<div class="grid-inferior">
<div class="box notaFinal">Nota Final<br><span id="notaFinal">6,00</span></div>
</div>

<div class="grid-rodape">
<div class="box">Data / Hora<br><span id="data"></span></div>
<div class="box">Avaliador<br><b id="avaliadorLogado"></b></div>
</div>

<div style="text-align:center;padding:10px">
<button onclick="salvar()">SALVAR</button>
<button onclick="logout()">SAIR</button>
</div>

</div>
</div>

<script>
const URL = "https://script.google.com/macros/s/AKfycbzH0pqO6lpSnKLoN2Rs-rHP4xR_JfiI0O4D9RsCNOxQjFUF09GdZgBIejicVrOFqcdg/exec";

function v(id){
  return parseFloat((document.getElementById(id)?.value||"0").replace(',','.'))||0;
}

function calc(){
  const final = 6 + v("notaInter") - (v("voz1")+v("voz2")+v("voz3"));
  notaFinal.textContent = final.toFixed(2).replace('.',',');
  data.textContent = new Date().toLocaleString();
}

function fazerLogin(){
  fetch(URL,{
    method:"POST",
    body:JSON.stringify({acao:"login",usuario:usuario.value,senha:senha.value})
  })
  .then(r=>r.json())
  .then(r=>{
    if(r.status==="OK"){
      localStorage.setItem("tokenAvaliador",r.token);
      localStorage.setItem("nomeAvaliador",r.nome);
      liberarSistema();
    }else erroLogin.textContent=r.msg;
  });
}

function liberarSistema(){
  loginBox.style.display="none";
  sistema.style.display="block";
  avaliadorLogado.textContent = localStorage.getItem("nomeAvaliador");
}

function logout(){
  localStorage.clear();
  location.reload();
}

function salvar(){

  if(!localStorage.getItem("tokenAvaliador")){
    alert("Sessão expirada. Faça login novamente.");
    location.reload();
    return;
  }

  fetch(URL, {
    method: "POST",
    body: JSON.stringify({
      token: localStorage.getItem("tokenAvaliador"),

      cod: codCandidato.value,
      concorrente: concorrente.textContent,
      categoria: categoria.textContent,
      entidade: entidade.textContent,
      municipio: municipio.textContent,
      rt: rt.textContent,

      voz1: v('voz1'),
      voz2: v('voz2'),
      voz3: v('voz3'),
      obsVoz: obsVoz.value,

      exp1: v('exp1'),
      exp2: v('exp2'),
      exp3: v('exp3'),
      obsExp: obsExp.value,

      notaInter: v('notaInter'),
      obsInter: obsInter.value,

      fid1: v('fid1'),
      fid2: v('fid2'),
      fid3: v('fid3'),
      obsFid: obsFid.value,

      descTempo: v('descTempo'),
      descInd: v('descInd'),
      obsGeral: obsGeral.value,

      notaFinal: notaFinal.textContent,
      data: new Date().toLocaleString()
    })
  })
  .then(r => r.json())
  .then(r => {
    if(r.status === "OK"){
      alert("Avaliação salva com sucesso");
      location.reload();
    } else {
      alert(r.msg || "Erro ao salvar");
    }
  });
}
if(localStorage.getItem("tokenAvaliador")) liberarSistema();
  
<button onclick="logout()">Sair</button>
  
function logout(){
  localStorage.clear();
  location.reload();
}


</script>

</body>
</html>


