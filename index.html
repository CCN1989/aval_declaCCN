<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Avaliação – Declamação</title>

<style>
/* ====== (ESTILOS ORIGINAIS – NÃO ALTERADOS) ====== */
body{font-family:Arial;background:#9c8a8a;margin:0;padding:10px}
.container{max-width:1200px;margin:auto;background:#fff;border:2px solid #000}
.header{background:#ffe066;border-bottom:2px solid #000;padding:10px}
.linha{display:grid;grid-template-columns:1fr 1fr 1fr 1fr 1fr;gap:5px;padding:5px;background:#ffe066}
.grid{display:grid;grid-template-columns:1fr 1fr 1fr 1fr;gap:5px;padding:5px}
.box{border:2px solid #000;background:#ffe066;padding:5px;font-size:13px}
.box h3{text-align:center;margin:0 0 5px}
textarea{width:100%;height:60px}
.notaFinal{font-size:22px;font-weight:bold;text-align:center}
select,input{width:100%}
.linha-nota{display:flex;align-items:center;gap:6px;margin-bottom:6px}
.linha-nota .texto{white-space:nowrap}
.linha-nota .pontilhado{flex:1;border-bottom:1px dotted #000}
.input-nota{width:42px;text-align:center}
.resumo-direita{display:flex;justify-content:space-between;font-weight:bold;margin-top:6px;border-top:1px solid #000;padding-top:4px}
.grid-inferior{display:grid;grid-template-columns:1.6fr 2.4fr 0.8fr;gap:6px;padding:6px}
.grid-rodape{display:grid;grid-template-columns:1fr 1fr;gap:6px;padding:6px}
.btns{display:flex;justify-content:center;padding:15px}
.btns button{font-size:18px;padding:12px 40px;background:#fc7a00;border:2px solid #000;border-radius:6px;cursor:pointer}
.btns button:hover{background:#1b5e20}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="loginBox" style="position:fixed;inset:0;background:#9c8a8a;display:flex;align-items:center;justify-content:center;z-index:9999">
  <div style="background:#ffe066;border:3px solid #000;padding:25px;width:360px;text-align:center">
    <h2>Acesso do Avaliador</h2>
    <input id="usuario" placeholder="Usuário"><br><br>
    <input id="senha" type="password" placeholder="Senha"><br><br>
    <button onclick="fazerLogin()">Entrar</button>
    <div id="erroLogin" style="color:red;margin-top:10px"></div>
  </div>
</div>

<div class="container">

<!-- CABEÇALHO -->
<div class="header">
  <strong>Planilha de Avaliação – Declamação</strong>
</div>

<!-- SELEÇÃO -->
<div style="padding:8px;background:#ffe066;border-bottom:2px solid #000">
<select id="codCandidato">
<option value="">Selecione CÓDIGO do candidato *</option>
</select>
</div>

<!-- DADOS -->
<div class="linha">
<div>Categoria:<br><b id="concorrente"></b></div>
<div>Concorrente:<br><b id="categoria"></b></div>
<div>Entidade:<br><b id="entidade"></b></div>
<div>Município:<br><b id="municipio"></b></div>
<div>RT:<br><b id="rt"></b></div>
</div>

<!-- RODAPÉ -->
<div class="grid-rodape">
<div class="box">Data / Hora<br><span id="data"></span></div>
<div class="box">
  Avaliador:<br>
  <b id="avaliadorLogado"></b><br><br>
  <button onclick="encerrarSessao()"
          style="width:100%;background:#c62828;color:#fff;border:2px solid #000">
    Encerrar Sessão
  </button>
</div>

</div>

<div class="btns">
<button onclick="salvar()">SALVAR</button>
</div>

</div>

<script>
const URL = "https://script.google.com/macros/s/AKfycbwzj00wVbaZY9Wv9f7ECzxJ1U3HbAG8KXg4L3rcLNdXVzyL7zh2wWSqgGqXof9TrJGc/exec";

/* ===== LOGIN ===== */
function fazerLogin(){
  const usuario = usuarioInput.value.trim();
  const senha = senhaInput.value.trim();

  fetch(URL,{
    method:"POST",
    body:JSON.stringify({acao:"login",usuario,senha})
  })
  .then(r=>r.json())
  .then(r=>{
    if(r.status==="OK"){
      localStorage.setItem("tokenAvaliador",r.token);
      localStorage.setItem("nomeAvaliador",r.nome);
      liberarSistema(r.nome);
    }else erroLogin.textContent=r.msg;
  });
}

function liberarSistema(nome){
  loginBox.style.display="none";
  avaliadorLogado.textContent = nome;
}

/* ===== SALVAR ===== */
function salvar(){
  if(!codCandidato.value){
    alert("Selecione o candidato");
    return;
  }

  fetch(URL,{
    method:"POST",
    body:JSON.stringify({
      token: localStorage.getItem("tokenAvaliador"),
      avaliador: localStorage.getItem("nomeAvaliador"),
      cod: codCandidato.value,
      notaFinal: notaFinal.textContent,
      data: new Date().toLocaleString()
    })
  })
  .then(r=>r.json())
  .then(r=>{
    if(r.status==="OK"){
      alert("Avaliação salva com sucesso");
      limparFormulario();
    }else alert(r.msg);
  });
}

function limparFormulario(){
  document.querySelectorAll("input, textarea").forEach(e=>e.value="");
  notaFinal.textContent="6,00";
}

/* ===== AUTOLOGIN ===== */
if(localStorage.getItem("tokenAvaliador")){
  liberarSistema(localStorage.getItem("nomeAvaliador"));
}

function encerrarSessao(){
  if(!confirm("Deseja realmente encerrar a sessão do avaliador?")) return;

  localStorage.removeItem("tokenAvaliador");
  localStorage.removeItem("nomeAvaliador");

  location.reload();
}
  
</script>

</body>
</html>
