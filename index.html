<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Avaliação – Declamação</title>

<style>
body{font-family:Arial;background:#f2f2f2;margin:0;padding:10px}
.container{max-width:1200px;margin:auto;background:#fff;border:2px solid #000}
.header{background:#ffe066;border-bottom:2px solid #000;padding:10px}
.linha,.rodape{display:grid;grid-template-columns:1fr 1fr 1fr 1fr 1fr;gap:5px;padding:5px;background:#ffe066}
.grid{display:grid;grid-template-columns:1fr 1fr 1fr 1fr;gap:5px;padding:5px}
.box{border:2px solid #000;background:#ffe066;padding:5px;font-size:13px}
.box h3{text-align:center;margin:0 0 5px}
textarea{width:100%;height:60px}
.notaFinal{font-size:20px;font-weight:bold;text-align:center}
.btns{text-align:right;padding:10px}
button{padding:10px 25px;font-size:16px;font-weight:bold}
select,input{width:100%}
</style>
</head>

<body>
<div class="container">

<!-- CABEÇALHO -->
<div class="header" style="display:grid;grid-template-columns:100px 1fr 100px;align-items:center">
<img src="https://raw.githubusercontent.com/CCN1989/Imagens/refs/heads/main/Logo%20pequeno.png" height="70">
<div style="text-align:center">
<strong>MTG – MOVIMENTO TRADICIONALISTA GAÚCHO</strong><br>
2º Chamas da Poesia – CTG Chama Nativa – 12ª RT<br>
(28/02/26 e 01/03/26)<br>
<strong>Planilha de Avaliação – Declamação</strong>
</div>
<img src="https://github.com/CCN1989/Imagens/blob/main/12RT.png?raw=true" height="70">
</div>

<!-- SELEÇÃO -->
<div style="padding:8px;background:#ffe066;border-bottom:2px solid #000">
<select id="codCandidato" onchange="carregarCandidato()">
<option value="">Selecione o candidato *</option>
</select>

</div>

<!-- DADOS -->
<div class="linha">
<div>Concorrente:<br><b id="concorrente"></b></div>
<div>Categoria:<br><b id="categoria"></b></div>
<div>Entidade:<br><b id="entidade"></b></div>
<div>Município:<br><b id="municipio"></b></div>
<div>RT:<br><b id="rt"></b></div>
</div>

<!-- QUADRANTES -->
<div class="grid">

<div class="box">
<h3>Fundamento da Voz (3,0)</h3>
Imposição <input id="voz1" type="number" step="0.1" oninput="calc()">
Dicção <input id="voz2" type="number" step="0.1" oninput="calc()">
Inflexão <input id="voz3" type="number" step="0.1" oninput="calc()">
Descontos: <b id="descVoz">0,0</b><br>
Nota: <b id="notaVoz">3,0</b>
<textarea id="obsVoz"></textarea>
</div>

<div class="box">
<h3>Expressão Corporal (2,0)</h3>
Facial <input id="exp1" type="number" step="0.1" oninput="calc()">
Gestual <input id="exp2" type="number" step="0.1" oninput="calc()">
Postura <input id="exp3" type="number" step="0.1" oninput="calc()">
Descontos: <b id="descExp">0,0</b><br>
Nota: <b id="notaExp">2,0</b>
<textarea id="obsExp"></textarea>
</div>

<div class="box">
<h3>Interpretação (4,0) *</h3>
<input id="notaInter" type="number" step="0.1" min="0" max="4" oninput="calc()">
<textarea id="obsInter"></textarea>
</div>

<div class="box">
<h3>Fidelidade ao Texto (1,0)</h3>
Letra <input id="fid1" type="number" step="0.1" oninput="calc()">
Verso <input id="fid2" type="number" step="0.1" oninput="calc()">
Esqueceu <input id="fid3" type="number" step="0.1" oninput="calc()">
Descontos: <b id="descFid">0,0</b><br>
Nota: <b id="notaFid">1,0</b>
<textarea id="obsFid"></textarea>
</div>

</div>

<!-- DESCONTOS -->
<div class="grid">
<div class="box">Tempo <input id="descTempo" type="number" step="0.1" oninput="calc()"></div>
<div class="box">Indumentária <input id="descInd" type="number" step="0.1" oninput="calc()"></div>
<div class="box">Observações<textarea id="obsGeral"></textarea></div>
<div class="box notaFinal">Nota Final<br><span id="notaFinal">6,00</span></div>
</div>

<!-- RODAPÉ -->
<div class="rodape">
<div>Data/Hora<br><span id="data"></span></div>
<div>Avaliador *<br>
<select id="avaliador">
<option value="">Selecione *</option>
</select>
</div>
</div>

<div class="btns">
<button onclick="salvar()">SALVAR</button>
</div>

</div>

<script>
const URL = "https://script.google.com/macros/s/AKfycbxcVTgy7QQKCM1Olv7tcOkJ5qrn6KkbV4GM04SmeYQ7qrOZs8Wrjj8j06sbIw55r_E/exec";

let candidatos = [];

/* =========================
   CARREGAR CANDIDATOS
========================= */
fetch(URL + "?acao=candidatos")
  .then(r => r.json())
  .then(lista => {
    candidatos = lista;

    const sel = document.getElementById("codCandidato");
    sel.innerHTML = `<option value="">Selecione o candidato *</option>`;

    lista.forEach(c => {
      sel.innerHTML += `
        <option value="${String(c.codigo).trim()}">
          ${String(c.codigo).trim()}
        </option>`;
    });
  })
  .catch(err => {
    console.error(err);
    alert("Erro ao carregar candidatos");
  });

/* =========================
   AO SELECIONAR CANDIDATO
========================= */
document.getElementById("codCandidato").addEventListener("change", () => {

  const codigo = String(codCandidato.value).trim();

  const c = candidatos.find(x =>
    String(x.codigo).trim() === codigo
  );

  if (!c) {
    console.warn("Candidato não encontrado:", codigo);
    return;
  }

  document.getElementById("concorrente").textContent = c.concorrente;
  document.getElementById("categoria").textContent   = c.categoria;
  document.getElementById("entidade").textContent    = c.entidade;
  document.getElementById("municipio").textContent   = c.municipio;
  document.getElementById("rt").textContent          = c.rt;
});

   
/* =========================
   CARREGAR AVALIADORES
========================= */
fetch(URL + "?acao=avaliadores")
  .then(r => r.json())
  .then(lista => {
    const sel = document.getElementById("avaliador");
    sel.innerHTML = `<option value="">Selecione o avaliador *</option>`;

    lista.forEach(a => {
      sel.innerHTML += `
        <option value="${a.id}">
          ${a.id} - ${a.nome}
        </option>`;
    });
  })
  .catch(err => {
    console.error(err);
    alert("Erro ao carregar avaliadores");
  });

/* ===== CÁLCULO ===== */
function v(id){
  const el = document.getElementById(id);
  return el && el.value !== "" ? parseFloat(el.value) : 0;
}

function calc(){
  const dv = v('voz1') + v('voz2') + v('voz3');
  const de = v('exp1') + v('exp2') + v('exp3');
  const df = v('fid1') + v('fid2') + v('fid3');

  descVoz.textContent = dv.toFixed(1);
  descExp.textContent = de.toFixed(1);
  descFid.textContent = df.toFixed(1);

  notaVoz.textContent = (3 - dv).toFixed(2);
  notaExp.textContent = (2 - de).toFixed(2);
  notaFid.textContent = (1 - df).toFixed(2);

  const final = 6 + v('notaInter') - (dv + de + df + v('descTempo') + v('descInd'));
  notaFinal.textContent = final.toFixed(2);
  data.textContent = new Date().toLocaleString();
}

/* ===== SALVAR ===== */
function salvar(){

  if(!codCandidato.value){
    alert("Selecione o candidato");
    return;
  }
  if(!avaliador.value){
    alert("Selecione o avaliador");
    return;
  }

  fetch(URL,{
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body:JSON.stringify({
      cod: codCandidato.value,
      concorrente: concorrente.textContent,
      categoria: categoria.textContent,
      entidade: entidade.textContent,
      municipio: municipio.textContent,
      notafinal: notaFinal.textContent,
      avaliador: avaliador.value,
      data: new Date().toLocaleString()
    })
  })
  .then(r=>r.json())
  .then(r=>{
    if(r.status==="OK"){
      alert("Avaliação gravada com sucesso");
      location.reload();
    } else {
      alert("Erro: "+r.msg);
    }
  })
  .catch(()=>alert("Erro de comunicação"));
}
</script>

</body>
</html>















